window.addEvent("domready",function(){var a=Shop.url.fav_url;var f=Cookie.read("S[MEMBER]");var e=new Cookie("S[GFAV]["+f+"]",{duration:365});var c={"star-on":"off","star-off":"on",off:"del",on:"add",off_:"erase",on_:"include"};var b=function(i,j,h){i.className=i.className.replace("star-"+c["star-"+j],"star-"+j);i.title=j=="on"?"取消收藏":"加入收藏";if(!h){return}e.write(Array.from((e.read("S[GFAV]["+f+"]")||"").split(","))[c[j+"_"]](h).clean().join(","));var g=i.get("_type")?i.get("_type"):"goods";new Request({url:a}).post({t:new Date(),act_type:c[j],type:g,gid:h})};var d=Array.from((e.read("S[GFAV]["+f+"]")||"").split(","));_fav_=function(){$$("li[star]").each(function(h){var g=h.get("star");if(d.contains(g)){b(h,"on")}});Ex_Event_Group._fav_={fn:function(h,j){j.stop();h=$(h.target)||$(h);var i=$(h).getParent("li");var g=i.hasClass("star-on")?"star-on":"star-off";b(i,c[g],i.get("star"))}}};_fav_()});window.addEvent("domready",function(){var e=$("goods-compare")||new Element("div").set("html",["<div class='FormWrap goods-compare' id='goods-compare' style='display:none;'>","<div class='title clearfix'><h3 class='flt'>"+LANG_goodscupcake.goodsCompare+"</h3><span class='close-gc del-bj frt' onclick='gcompare.hide();'>"+LANG_goodscupcake.close+"</span></div>","<form action='"+Shop.url.diff+"' method='post' target='_compare_goods'>","<ul class='compare-box'>","<li class='division clearfix tpl'>","<div class='goods-name'>","<a href='{url}' gid='{gid}' title='{gname}'>{gname}</a>","</div>","<a class='btn-delete' onclick='gcompare.erase(\"{gid}\",this);'>"+LANG_goodscupcake.del+"</a>","</li>","</ul>","<div class='compare-bar'>","<button name='comareing' type='button' onclick='gcompare.submit()' class='btn-compare btn submit-btn'><span><span>对比</span></span></button>","<button class='btn-compare btn' type='button' onclick='gcompare.empty()'><span><span>清空</span></span></button>","</div>","</form>","</div>"].join("\n")).getFirst().inject(document.body);var d=e.getElement(".compare-box");var b=e.getElement(".compare-box .tpl").get("html");var f="division clearfix";if(!Browser.ie6){e.setStyle("position","fixed")}else{var c=function(){if(e.style.display=="none"){return}e.setStyle("top",window.getScrollTop())};window.addEvents({scroll:c})}var a=new Cookie("S[GCOMPARE]");gcompare={init:function(){var g=Array.from((a.read("S[GCOMPARE]")||"").split("|")).erase("").clean();if(g.length){g.each(function(h){this.add(JSON.decode(h),true)}.bind(this))}},hide:function(){e.hide()},show:function(){e.show();if(Browser.ie6){c()}},add:function(g,l){this.show();if(!l){var k=Array.from((a.read("S[GCOMPARE]")||"").split("|")).erase("").clean();var i="errortype";if(k.length&&k.some(function(n){var m=JSON.decode(n)["gid"]==g.gid;if(m){i="isset"}return((JSON.decode(n)["gtype"]+"_")!=(g.gtype+"_"))||m})){return MessageBox.error(LANG_goodscupcake[i])}if(k.length>4){return MessageBox.error(LANG_goodscupcake.lengtherror)}a.write(k.include(JSON.encode(g)).join("|"))}if(d.getElement('a[gid="'+g.gid+'"]')){return this}var h=new Element("li",{"class":f}).set("html",b.substitute(g));var j=h.getElement("a");j.set("href",g.url);return d.adopt(h)},erase:function(h,g){var i=Array.from((a.read("S[GCOMPARE]")||"").split("|")).erase("").clean();i.each(function(j){if((JSON.decode(j)&&JSON.decode(j)["gid"]+"_")==(h+"_")){i.erase(j)}});a.write(i.join("|"));$(g).getParent("li").destroy()},empty:function(){a.dispose();d.getElements("li").each(function(g){if(!g.hasClass("tpl")){return g.destroy()}});e.hide()},submit:function(){if(d.getElements("li").length<3){MessageBox.error(LANG_goodscupcake.minlengtherror);return}d.getParent("form").submit()}};gcompare.init();Ex_Event_Group._gcomp_={fn:function(g,h){gcompare.add(JSON.decode($(g).get("data-gcomp")))}}});